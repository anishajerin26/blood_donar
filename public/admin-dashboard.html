<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<nav class="navbar navbar-light bg-white shadow-sm px-3">
  <span class="navbar-brand fw-bold">Admin Dashboard</span>
  <button class="btn btn-danger" onclick="logoutAdmin()">Logout</button>
</nav>

<div class="container mt-4">
  <h3>Emergency Requests</h3>
  <div id="requestList"></div>
</div>

<script>
async function loadRequests() {
  const res = await fetch('/api/requests');
  const data = await res.json();

  const container = document.getElementById("requestList");
  container.innerHTML = "";

  data.requests.forEach(r => {
    container.innerHTML += `
      <div class="card mb-3">
        <div class="card-body">
          <h5>${r.patient_name} needs <span class="badge bg-danger">${r.blood_group}</span></h5>
          <p><strong>City:</strong> ${r.city}</p>
          <p><strong>Hospital:</strong> ${r.hospital}</p>
          <p><strong>Phone:</strong> ${r.contact_phone}</p>
          <p>Status: <span class="badge ${r.status === 'Pending' ? 'bg-warning' : 'bg-success'}">${r.status}</span></p>

          ${r.status === "Pending" ? `
            <button class="btn btn-success" onclick="markCompleted('${r._id}')">Mark Completed</button>
          ` : ""}
        </div>
      </div>
    `;
  });
}

async function markCompleted(id) {
  const res = await fetch(`/api/requests/${id}`, {
    method: "PUT"
  });

  const data = await res.json();
  if (data.ok) {
    alert("Marked as Completed");
    loadRequests();
  }
}

async function logoutAdmin() {
  await fetch("/api/admin/logout");
  window.location.href = "admin-login.html";
}

loadRequests();
</script>

</body>
</html>
